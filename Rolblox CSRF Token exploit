import requests

cookie = input("Account cookie: ")

session = requests.session()
session.cookies['.ROBLOSECURITY'] = cookie

def grabCSRF():
    r = session.post("https://auth.roblox.com/v2/user/passwords/change")
    csrf = r.headers['x-csrf-token']
    return csrf

csrf = grabCSRF()

r = session.get('https://api.roblox.com/users/account-info', headers={'x-csrf-token':csrf})
UserId = r.json()['UserId']
Username = r.json()['Username']
r = requests.get(f"https://friends.roblox.com/v1/users/{UserId}/followers/count")
followingcount = r.json().pop("count")
print(f"Logged into {Username} │ User ID {UserId} │ Following {followingcount}")

def unfollow(UID):
    unfollowedcount = 0
    check = requests.get(f"https://friends.roblox.com/v1/users/{UID}/followings?sortOrder=Asc&limit=100", headers={'x-csrf-token':csrf})
    data = check.json()
    data = data['data']
    for val in data:
        if val['id']:
                targetid = val['id']
                r = session.post(f"https://friends.roblox.com/v1/users/{targetid}/unfollow" , headers={'x-csrf-token':csrf})
                unfollowedcount += 1
    nextcursor = check.json()
    if not nextcursor["nextPageCursor"]:
        print(f"Unfollowed everyone! │ Unfollowed {unfollowedcount} people.")
        return
    nextcursor = nextcursor["nextPageCursor"]
    while True:
        r = requests.get(f"https://friends.roblox.com/v1/users/{UID}/followings?sortOrder=Asc&limit=100&cursor={nextcursor}" , headers={'x-csrf-token':csrf})
        nextcursor = r.json()
        nextcursor = nextcursor["nextPageCursor"]
        data = r.json()
        data = data['data']
        for val in data:
            if val['id']:
                targetid = val['id']
                r = session.post(f"https://friends.roblox.com/v1/users/{targetid}/unfollow" , headers={'x-csrf-token':csrf})
                unfollowedcount += 1
        if not nextcursor:
            print(f"Unfollowed everyone! │ Unfollowed {unfollowedcount} people.")
            return

unfollow(UserId)
